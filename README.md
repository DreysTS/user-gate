# User Gate API

Простой сервис работы с пользователями на Express + Prisma + PostgreSQL.

---

## Стек технологий

- Node.js + TypeScript
- Express
- Prisma ORM
- PostgreSQL
- Docker
- JWT авторизация

---

## Модель пользователя

| Поле          | Тип                   | Описание                              |
| ------------- | --------------------- | ------------------------------------- |
| `id`          | `string`              | Уникальный идентификатор пользователя |
| `name`        | `string`              | Имя пользователя                      |
| `surname`     | `string`              | Фамилия                               |
| `patronymic`  | `string`              | Отчество (опционально)                |
| `dateOfBirth` | `Date`                | Дата рождения                         |
| `email`       | `string`              | Email, уникальное значение            |
| `password`    | `string`              | Пароль пользователя                   |
| `role`        | `USER / ADMIN`        | Роль пользователя                     |
| `status`      | `ACTIVE / NON_ACTIVE` | Статус пользователя                   |

---

## Endpoints

| Метод | URL               | Описание                       | Доступ        |
| ----- | ----------------- | ------------------------------ | ------------- |
| POST  | `/auth/register`  | Регистрация пользователя       | Все           |
| POST  | `/auth/login`     | Авторизация пользователя       | Все           |
| GET   | `/user/:id`       | Получение пользователя по ID   | Админ или сам |
| GET   | `/user`           | Получение списка пользователей | Админ         |
| PATCH | `/user/:id/block` | Блокировка пользователя        | Админ или сам |

---

## Запуск проекта

- Файл `.env.example` нужно переименовать в `.env`.
- Запустить контейнер с базой данных Postgres:

```bash
docker compose up -d
```

- Заполнить её данными из `schema.prisma`:

```bash
npx prisma generate
```

- И окончательно запустить бэкенд:

```bash
npm run dev
```

## Тестирование

Для тестирования API была представлена коллекция `user-gate.postman_collection` - её можно импортировать в postman и протестировать ручками. В коллекции будут представлены готовые JSON объекты для авторизации и регистрации.

### Регистрация

`POST /auth/register`
```json
{
  "name": "Иван",
  "surname": "Иванов",
  "patronymic": "Иванович",
  "dateOfBirth": "2005-01-01",
  "email": "ivanov@gmail.com",
  "password": "Qwerty123456"
}
```

### Авторизация

`POST /auth/login`
```json
{
  "email": "ivanov@gmail.com",
  "password": "Qwerty123456"
}
```

Для тестирования работы с пользователями (получение одного/всех, бан пользователя) нужно зарегистрировать или войти с помощью инструкций по входу/регистрации, скопировать полученный токен, зайти в один из эндпоинтов папки users и в поле Authorization выбрать Auth Type - `Bearer token` и вставить скопированный токен в появившееся справа окошко.

Без прав админа можно попробовать получить всех пользователей: `GET /users`

Чтобы проверить работоспособность эндпоинтов на получение и бан пользователя, при регистрации или авторизации в сообщении ответа скопировать айди пользователя и вставить его в параметры под ключём id: `GET /users/:id` и `PATCH /users/:id/block`.

Чтобы проверить, как админ может получать и блокировать пользователя, внутри проекта нужно ввести команду

```bash
npx prisma studio
```

После этого автоматически откровается страница с базой данных, либо нужно будет перейти по ссылке, которую мы получим в терминале. Перейти во вкладку users, найти своего пользователя и поменять его роль с USER на ADMIN.

После всех проделанных действий, нужно будет заново получить токен авторизации `POST /auth/login`, снова ввести его в поле `Authorization` и снова пртестировать предыдущие эндпоинты
